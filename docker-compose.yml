version: '3.4'

services:
  healthcheck:
    image: xabarilcoding/healthchecksui:5.0.0
    depends_on:
      - archiver

  redis-state:
    image: redis:7

  redis-pubsub:
    image: redis:7

  seq:
    image: datalust/seq:latest

  zipkin:
    image: openzipkin/zipkin-slim

  booru-api:
    image: youliao/booruapi:dev

  booru-api-dapr:
    image: "daprio/daprd:1.7.4"
    network_mode: "service:booru-api"
    depends_on:
      - booru-api

  archiver:
    image: ${DOCKER_REGISTRY-}ashlakeservicesarchiver
    build:
      context: .
      dockerfile: src/Services/AshLake.Services.Archiver/Dockerfile
    depends_on:
      - archiver-mongo
      - archiver-redis

  archiver-dapr:
    image: "daprio/daprd:1.7.4"
    network_mode: "service:archiver"
    depends_on:
      - archiver

  archiver-mongo:
    image: mongo:4

  archiver-redis:
    image: redis:7

  collector:
    image: youliao/collector:dev
    depends_on:
      - collector-aria2
      - collector-minio
      - collector-rclone

  collector-dapr:
    image: "daprio/daprd:1.7.4"
    network_mode: "service:collector"
    depends_on:
      - collector

  collector-minio:
    image: minio/minio:latest

  collector-imgproxy:
    image: darthsim/imgproxy:latest
    depends_on:
      - collector-minio

  collector-aria2:
    image: superng6/aria2:webui-latest
    depends_on:
      - collector-rclone

  collector-rclone:
    image: rclone/rclone:latest
    depends_on:
      - collector-minio

  #yandestore:
  #  image: ${DOCKER_REGISTRY-}ashlakeservicesyandestore
  #  build:
  #    context: .
  #    dockerfile: src/Services/AshLake.Services.YandeStore/Dockerfile
  #  depends_on:
  #    - yandestore-redis
  #    - yandestore-postgres

  #yandestore-dapr:
  #  image: "daprio/daprd:1.7.4"
  #  network_mode: "service:yandestore"
  #  depends_on:
  #    - yandestore

  #yandestore-postgres:
  #  image: postgres:14

  #yandestore-redis:
  #  image: redis:7